<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <base href="/nhs-dev-docs">
     <link rel="stylesheet"  href="nhs-dev-docs/css/main.css">
      <link rel="stylesheet"  href="nhs-dev-docs/css/mobile-menu.css">
    <script src="nhs-dev-docs/js/main.min.js" ></script> 
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <title>GP Credentials scope and processing overview</title>
  </head>
  <body>
      <header class="nhsuk-header" role="banner">
        <div class="nhsuk-width-container nhsuk-header__container">
          <div class="nhsuk-header__logo">
            <a class="nhsuk-header__link nhsuk-header__link--service " href="/nhs-dev-docs" aria-label="NHS digital service manual homepage">
              <svg class="nhsuk-logo" xmlns="http://www.w3.org/2000/svg" role="presentation" focusable="false" viewBox="0 0 40 16">
                <path class="nhsuk-logo__background" d="M0 0h40v16H0z"></path>
                <path class="nhsuk-logo__text" d="M3.9 1.5h4.4l2.6 9h.1l1.8-9h3.3l-2.8 13H9l-2.7-9h-.1l-1.8 9H1.1M17.3 1.5h3.6l-1 4.9h4L25 1.5h3.5l-2.7 13h-3.5l1.1-5.6h-4.1l-1.2 5.6h-3.4M37.7 4.4c-.7-.3-1.6-.6-2.9-.6-1.4 0-2.5.2-2.5 1.3 0 1.8 5.1 1.2 5.1 5.1 0 3.6-3.3 4.5-6.4 4.5-1.3 0-2.9-.3-4-.7l.8-2.7c.7.4 2.1.7 3.2.7s2.8-.2 2.8-1.5c0-2.1-5.1-1.3-5.1-5 0-3.4 2.9-4.4 5.8-4.4 1.6 0 3.1.2 4 .6"></path>
                <image src="https://assets.nhs.uk/images/nhs-logo.png" xlink:href=""></image>
              </svg>
              <span class="nhsuk-header__service-name">
              NHS login Docs
            </span>
            </a>
          </div>
          <div class="nhsuk-header__menu">
            <button class="nhsuk-header__menu-toggle" id="toggle-menu" aria-controls="header-navigation" aria-label="Open menu">Menu</button>
          </div>

          <div class="nhsuk-header__content" id="content-header"></form>
        </div>
      </div>
    </div>
  </div>
  <nav class="nhsuk-header__navigation mobile-menu" id="header-navigation" role="navigation" aria-label="Primary navigation"
  aria-labelledby="label-navigation">
  <div class="nhsuk-width-container">
    <p class="nhsuk-header__navigation-title"><span id="label-navigation">Menu</span>
      <button class="nhsuk-header__navigation-close" id="close-menu">
        <svg class="nhsuk-icon nhsuk-icon__close" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
          aria-hidden="true" focusable="false">
          <path
            d="M13.41 12l5.3-5.29a1 1 0 1 0-1.42-1.42L12 10.59l-5.29-5.3a1 1 0 0 0-1.42 1.42l5.3 5.29-5.3 5.29a1 1 0 0 0 0 1.42 1 1 0 0 0 1.42 0l5.29-5.3 5.29 5.3a1 1 0 0 0 1.42 0 1 1 0 0 0 0-1.42z">
          </path>
        </svg>
        <span class="nhsuk-u-visually-hidden">Close menu</span>
      </button>
    </p>
    <ul class="nhsuk-header__navigation-list">
      <li>
        <h2 class="app-side-nav__heading mobile-menu__heading">
          NHS Login
        </h2>
      </li>
      <li class="nhsuk-header__navigation-item nhsuk-header__navigation-item--for-mobile">
        <a class="nhsuk-header__navigation-link" href="/">
          What is NHS login
          <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            aria-hidden="true">
            <path
              d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z">
            </path>
          </svg>
        </a>
      </li>

      <li class="nhsuk-header__navigation-item">
        <a class="nhsuk-header__navigation-link" href="/nhs-dev-docs/oidc-login-flow">
          The OIDC login flow
          <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            aria-hidden="true">
            <path
              d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z">
            </path>
          </svg>
        </a>
      </li>

      <li>
        <h2 class="app-side-nav__heading mobile-menu__heading">
          New to this document?
        </h2>
      </li>

      <li class="nhsuk-header__navigation-item app-header__navigation-item__item--current">
        <a class="nhsuk-header__navigation-link" href="/nhs-dev-docs/reference-guide">
          A quick reference guide
          <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            aria-hidden="true">
            <path
              d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z">
            </path>
          </svg>
        </a>
      </li>

       <li>
        <h2 class="app-side-nav__heading mobile-menu__heading">
          External Interface Specification
        </h2>
      </li>

      <li class="nhsuk-header__navigation-item">
        <a class="nhsuk-header__navigation-link" href="/nhs-dev-docs/interface-spec-doc">
          Interface Specification Document
          <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            aria-hidden="true">
            <path
              d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z">
            </path>
          </svg>
        </a>
      </li>

      <li>
        <h2 class="app-side-nav__heading mobile-menu__heading">
          Conformance
        </h2>
      </li>

      <li class="nhsuk-header__navigation-item">
        <a class="nhsuk-header__navigation-link" href="/nhs-dev-docs/technical-conformance">
          Technical Conformance
          <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            aria-hidden="true">
            <path
              d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z">
            </path>
          </svg>
        </a>
      </li>

      <li>
        <h2 class="app-side-nav__heading mobile-menu__heading">
          Developer Support Information
        </h2>
      </li>

      <li class="nhsuk-header__navigation-item">
        <a class="nhsuk-header__navigation-link" href="/nhs-dev-docs/developer-support">
          Developer Support
          <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            aria-hidden="true">
            <path
              d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z">
            </path>
          </svg>
        </a>
      </li>

       <li>
        <h2 class="app-side-nav__heading mobile-menu__heading">
          GP Credentials
        </h2>
      </li>

       <li class="nhsuk-header__navigation-item">
        <a class="nhsuk-header__navigation-link" href="/nhs-dev-docs/gp-credentials-para">
          Using NHS login to create or retrieve GP credentials
          <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            aria-hidden="true">
            <path
              d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z">
            </path>
          </svg>
        </a>
      </li>

      <li class="nhsuk-header__navigation-item">
        <a class="nhsuk-header__navigation-link" href="/nhs-dev-docs/gp-credentials-doc">
          Scope and processing overview
          <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            aria-hidden="true">
            <path
              d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z">
            </path>
          </svg>
        </a>
      </li>

      <li>
        <h2 class="app-side-nav__heading mobile-menu__heading">
          Button Guidance
        </h2>
      </li>

      <li class="nhsuk-header__navigation-item">
        <a class="nhsuk-header__navigation-link" href="/nhs-dev-docs/adding-buttons">
          Adding the NHS login button to your service
          <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            aria-hidden="true">
            <path
              d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z">
            </path>
          </svg>
        </a>
      </li>

      <li>
        <h2 class="app-side-nav__heading mobile-menu__heading">
          Linking your Service
        </h2>
      </li>

      <li class="nhsuk-header__navigation-item">
        <a class="nhsuk-header__navigation-link" href="/nhs-dev-docs/linking-to-settings-para">
          About linking
          <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            aria-hidden="true">
            <path
              d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z">
            </path>
          </svg>
        </a>
      </li>

      <li class="nhsuk-header__navigation-item">
        <a class="nhsuk-header__navigation-link" href="/nhs-dev-docs/linking-to-settings-ppt">
          Guidance
          <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            aria-hidden="true">
            <path
              d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z">
            </path>
          </svg>
        </a>
      </li>

       <li>
        <h2 class="app-side-nav__heading mobile-menu__heading">
          Examples
        </h2>
      </li>

      <li class="nhsuk-header__navigation-item">
        <a class="nhsuk-header__navigation-link" href="/nhs-dev-docs/example-oidc">
          Different implementations and integration of service
          <svg class="nhsuk-icon nhsuk-icon__chevron-right" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
            aria-hidden="true">
            <path
              d="M15.5 12a1 1 0 0 1-.29.71l-5 5a1 1 0 0 1-1.42-1.42l4.3-4.29-4.3-4.29a1 1 0 0 1 1.42-1.42l5 5a1 1 0 0 1 .29.71z">
            </path>
          </svg>
        </a>
      </li>
    </ul>
  </div>
</nav>
</header>

<div class="nhsuk-width-container">
  <main class="nhsuk-main-wrapper app-main-wrapper" id="maincontent">

    <div class="nhsuk-grid-row">
      <div class="nhsuk-grid-column-full app-component-reading-width">

        <div class="app-pane">

         <div class="app-pane__side-bar">

            <nav class="app-side-nav">
            
                <h2 class="app-side-nav__heading">NHS login</h2>
                <ul class="nhsuk-list app-side-nav__list">

                  <li class="app-side-nav__item">
                    <a class="app-side-nav__link" href="/nhs-dev-docs">What is NHS login?</a>
                  </li>
                  <li class="app-side-nav__item">
                    <a class="app-side-nav__link" href="nhs-dev-docs/oidc-login-flow">The OIDC login flow</a>
                  </li>
                </ul>

                <h2 class="app-side-nav__heading">New to this document?</h2>
                <ul class="nhsuk-list app-side-nav__list">

                  <li class="app-side-nav__item">
                    <a class="app-side-nav__link" href="nhs-dev-docs/reference-guide">A quick reference guide</a>
                  </li>
                </ul>

                <h2 class="app-side-nav__heading">External Interface Specification</h2>
                <ul class="nhsuk-list app-side-nav__list">

                  <li class="app-side-nav__item">
                    <a class="app-side-nav__link" href="nhs-dev-docs/interface-spec-doc">Interface Specification Document</a>
                </ul>

                <h2 class="app-side-nav__heading">Conformance</h2>
                <ul class="nhsuk-list app-side-nav__list">

                  <li class="app-side-nav__item">
                    <a class="app-side-nav__link" href="nhs-dev-docs/technical-conformance">Technical Conformance</a>
                  </li>
                </ul>

                <h2 class="app-side-nav__heading">Developer Support Information</h2>
                <ul class="nhsuk-list app-side-nav__list">

                  <li class="app-side-nav__item">
                    <a class="app-side-nav__link" href="nhs-dev-docs/developer-support">Developer Support</a>
                  </li>
                </ul>

                <h2 class="app-side-nav__heading">GP Credentials</h2>
                <ul class="nhsuk-list app-side-nav__list">
                   <li class="app-side-nav__item">
                    <a class="app-side-nav__link" href="nhs-dev-docs/gp-credentials-para">Using NHS login to create or retrieve GP credentials</a>
                  </li>
                  <li class="app-side-nav__item">
                    <a class="app-side-nav__link" href="nhs-dev-docs/gp-credentials-doc">Scope and processing overview </a>
                  </li>
                </ul>
                <h2 class="app-side-nav__heading">Button Guidance</h2>
                <ul class="nhsuk-list app-side-nav__list">

                  <li class="app-side-nav__item">
                    <a class="app-side-nav__link" href="nhs-dev-docs/adding-buttons">Adding the NHS login button to your service</a>
                  </li>
                </ul>
                <h2 class="app-side-nav__heading">Linking your Service</h2>
                <ul class="nhsuk-list app-side-nav__list">
                  <li class="app-side-nav__item">
                    <a class="app-side-nav__link" href="nhs-dev-docs/linking-to-settings-para">About linking</a>
                  </li>
                   <li class="app-side-nav__item">
                    <a class="app-side-nav__link" href="nhs-dev-docs/linking-to-settings-ppt">Guidance</a>
                  </li>
                </ul>
                <h2 class="app-side-nav__heading">Examples</h2>
                <ul class="nhsuk-list app-side-nav__list">
                  <li class="app-side-nav__item">
                    <a class="app-side-nav__link" href="nhs-dev-docs/example-oidc">Different implementations and integration of service</a>
                  </li>
                </ul>
            </nav>
          </div>

          <div class="app-pane__main-content">

            <h1 class="app-page-heading">
              GP Credentials scope and processing overview
            </h1>

            <h2>Introduction</h2>
<p>NHS login supports a scope of gp_integration_credentials which will allow a Relying Party (RP) to retrieve the following user claims:</p>
<ul>
<li>Account ID</li>
<li>ODS Code</li>
<li>Linkage Key</li>
</ul>
<p>These three pieces of information are required by IM1 paired services to create an IM1 token which is then used by the RP to invoke the GP system patient facing APIs.</p>
<p>Retrieving these items of information via NHS login removes the need for the user to enter them manually, as well as being able to seamlessly register previously unregistered GP Online users – preventing a visit to a GP Practice.</p>
<p><img src="nhs-dev-docs/images/gp-credentials-diagram.png" alt="Diagram"></p>
<h2>This diagram illustrates:</h2>
<ol>
<li>How NHS login processes a request from an RP for gp_integration_credentials via the /userinfo endpoint</li>
<li>How NHS login validates gp_integration_credentials on each request and how gp_integration_credentials are refreshed if the information held by NHS login is invalid</li>
</ol>
<h2>GP integration credentials validation</h2>
<p>When <strong>gp_integration_credentials</strong> scope is requested by an RP, NHS login performs a background check of the validity of a stored IM1 token.</p>
<p>As this check runs in the background asynchronously, it is the responsibility of the RP to also validate their IM1 token (if one exists).</p>
<p>If the RP determines that the claims returned from gp_integration_credentials scope are not valid it can request refreshed claims from NHS login by re-starting the login process.</p>
<p>Optional - the RP can utilise the “asserted_login_identity” request parameter to avoid the user needing to re-authenticate.</p>
<h2>GP integration credentials are no longer valid</h2>
<p>The reasons that the GP credentials might no longer be valid are:</p>
<ol>
<li>The user has moved GP Practice.</li>
<li>The GP Practice has changed GP systems.</li>
<li>GP Practices merge / divides.</li>
<li>The user’s GP online access been revoked at the GP system. This could be for multiple failed login attempts for example.</li>
</ol>
<p>In cases 1, 2 and 3 generally the ODS code for the user changes and will be detected by NHS login automatically via a separate background process that validates PDS information relating to the user.</p>
<h2>Assumptions:</h2>
<ul>
<li>
<p>When GP credentials (linkage keys) expire or get invalidated all the IM1 tokens generated using them also expire/get invalidated.</p>
</li>
<li>
<p>RP should cater for user journey which prevents the user getting into an endless “retrieve GP credential” loop if the credentials genuinely can’t be retrieved.</p>
</li>
</ul>
<h2>GP systems coverage</h2>
<p>Currently NHS login provides coverage for GP login credentials as per below:</p>
<ul>
<li>EMIS :  100%</li>
<li>TPP  : 100%</li>
<li>Vision : 3 Practices (250 in total – rollout in progress)</li>
<li>Microtest **: None (36 in total)</li>
</ul>
<p>** GP login credentials (linkage keys) for Microtest returned by NHS login are dummy in nature (to maintain the uniform behaviour of the service). These GP login credentials cannot be used by RPS for connecting to Microtest.</p>


     <div class="app-edit-instructions">
              <hr />
              <h2>Want to edit this page?</h2>
              <ol>
                <li>Click this <a href="https://github.com/faithmawi/nhs-dev-docs/blob/master/./src/gp-credentials-doc.md">link</a></li>
                <li>Then click the edit button in the top right of the document</li>
                <li>Make sure you click <strong>Commit changes</strong> when you're done</li>
              </ol>
      </div>

            <div class="app-index-navigation app-u-hide-desktop">
              <nav class="app-side-nav">
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<footer role="contentinfo">
  <div class="nhsuk-footer" id="nhsuk-footer">
    <div class="nhsuk-width-container">
      <h2 class="nhsuk-u-visually-hidden">Support links</h2>
      <ul class="nhsuk-footer__list">
        <li class="nhsuk-footer__list-item">
          <a class="nhsuk-footer__list-item-link" href="https://github.com/nhsconnect/nhslogin">Our Github Repository</a>
        </li>
       <li class="nhsuk-footer__list-item">
          <a class "nhsuk-footer__list-item-link" href="https://nhs-login-support-slack-invite.herokuapp.com/">Slack</a>
        </li>
      </ul>
      <p class="nhsuk-footer__copyright">© Crown copyright</p>
    </div>
  </div>
  <div class="app-ogl-footer">
    <div class="nhsuk-width-container"></div>
  </div>
</footer>
<script src="nhs-dev-docs/js/mobile-menu.js" ></script> 
</body>
</html>